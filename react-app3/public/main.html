<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/redux/4.2.0/redux.min.js"></script>
    <title>실전 Redux</title>
</head>
<body>
     <div id="subject"></div>
     <div id="toc"></div>
     <div id="control"></div>
     <div id="content"></div>

     <script>
function subject(){
    document.querySelector("#subject").innerHTML=`
            <header>
                <h1>WEB</h1>
                Hello, WEB!
            </header>
    `;
}
function TOC(){
    const state=store.getState();
    const liTags= state.contents.map(item=>{
        return `        
         <li><a href="#"
            onclick="event.preventDefault();            
            const action={
                type:'SELECT', 
                id:${item.id}
            }
            store.dispatch(action);
            "
            href="${item.id}">${item.title}</a></li>
        `;
    });

    document.querySelector("#toc").innerHTML=`
    <nav>
        <ol>
            ${liTags.join("")}     
        </ol>
    </nav>
    `;
}
function control(){
    document.querySelector("#control").innerHTML=`
        <ul>
            <li><a 
                onclick="
                    event.preventDefault();
                
                "
                
                href="/create">create</a></li>
             <li><a 
                onclick="event.preventDefault();
                
                "                
                href="/update">update</a></li>
            <li><input type="button" value="delete"></li>
        </ul>
    `;
}

function article(){
    const state=store.getState();
    console.log(" state", state);

    if(state.selectd_id!=undefined){
        const data=state.contents.filter(item=>{            
            return item.id==state.selectd_id;
        })[0]; 
        
        document.querySelector("#content").innerHTML=`
            <article>
                <h2>${data.title}</h2>
                ${data.desc}
            </article>
        `;
    }
}

function reducer(state, action){  
    if(state===undefined){
        return{
            selectd_id:2,
            contents:[
                {id:1,title:'HTML',desc:"HTML is ..."},
                {id:2,title:'CSS', desc:"CSS is ..."},
                {id:3,title:'js', desc:"js is ..."}
            ]
        }
    }

    let newState={};
    if(action.type==="SELECT"){
        //깊은 복사
       newState=Object.assign({}, state, {selectd_id:action.id});
    }

    console.log(action, state, newState);
    return newState;
}

const store=Redux.createStore(reducer);
store.subscribe(article);

subject();
TOC();
control();
article();
        </script>
        
</body>
</html>